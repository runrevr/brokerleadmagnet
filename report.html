<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Transactional Risk Profile | ContRE</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Manrope:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <!-- Tailwind Custom Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'bebas': ['"Bebas Neue"', 'cursive'],
                        'manrope': ['Manrope', 'sans-serif'],
                        'jetbrains': ['"JetBrains Mono"', 'monospace']
                    },
                    colors: {
                        'lime-green': '#84cc16',
                        'slate-blue': '#2C3E50',
                        'signal-red': '#CC0000',
                        'amber': '#F59E0B'
                    }
                }
            }
        }
    </script>

    <style>
        @media print {
            .no-print { display: none !important; }
            .page-break { page-break-before: always; }
            body { font-size: 12pt; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        const ReportPage = () => {
            const [report, setReport] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [copied, setCopied] = useState(false);
            const [aiGenerating, setAiGenerating] = useState(false);
            const [emailSubmitted, setEmailSubmitted] = useState(false);
            const [email, setEmail] = useState('');
            const [emailError, setEmailError] = useState('');
            const [submittingEmail, setSubmittingEmail] = useState(false);
            const gaugeRef = useRef(null);
            const pollIntervalRef = useRef(null);

            useEffect(() => {
                fetchReport();

                // Cleanup polling on unmount
                return () => {
                    if (pollIntervalRef.current) {
                        clearInterval(pollIntervalRef.current);
                    }
                };
            }, []);

            const fetchReport = async (isPolling = false) => {
                try {
                    const params = new URLSearchParams(window.location.search);
                    const token = params.get('id');

                    if (!token) {
                        setError('No report token provided');
                        setLoading(false);
                        return;
                    }

                    const response = await fetch(`/api/report-get?id=${token}`);
                    const data = await response.json();

                    if (!response.ok) {
                        throw new Error(data.message || data.error || 'Failed to load report');
                    }

                    setReport(data.report);
                    setLoading(false);

                    // Check if AI content is missing - if so, start polling
                    if (!data.report.executiveSummary || !data.report.fullAnalysis) {
                        if (!isPolling) {
                            console.log('[REPORT] AI content not ready yet, starting polling...');
                            console.log('[REPORT] Has executive summary:', !!data.report.executiveSummary);
                            console.log('[REPORT] Has full analysis:', !!data.report.fullAnalysis);
                            setAiGenerating(true);

                            // Poll every 5 seconds (increased from 3 to reduce server load)
                            pollIntervalRef.current = setInterval(() => {
                                fetchReport(true);
                            }, 5000);
                        }
                    } else {
                        // AI content is ready, stop polling
                        setAiGenerating(false);
                        if (pollIntervalRef.current) {
                            console.log('[REPORT] AI content ready, stopping polling');
                            clearInterval(pollIntervalRef.current);
                            pollIntervalRef.current = null;
                        }
                    }
                } catch (err) {
                    console.error('Error fetching report:', err);
                    setError(err.message);
                    setLoading(false);
                }
            };

            const handleShare = () => {
                const url = window.location.href;
                navigator.clipboard.writeText(url).then(() => {
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                });
            };

            const handlePrint = () => {
                window.print();
            };

            const handleEmailSubmit = async (e) => {
                e.preventDefault();
                setEmailError('');
                setSubmittingEmail(true);

                try {
                    const params = new URLSearchParams(window.location.search);
                    const token = params.get('id');

                    const response = await fetch('/api/email-capture', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            email,
                            assessmentId: report.id,
                            reportData: {
                                companyName: report.companyName,
                                overallScore: report.overallScore,
                                riskLevel: report.riskLevel
                            }
                        })
                    });

                    if (!response.ok) {
                        throw new Error('Failed to submit email');
                    }

                    setEmailSubmitted(true);

                    // Scroll to full report
                    setTimeout(() => {
                        document.getElementById('full-report')?.scrollIntoView({ behavior: 'smooth' });
                    }, 500);
                } catch (err) {
                    console.error('Error submitting email:', err);
                    setEmailError('Failed to submit email. Please try again.');
                } finally {
                    setSubmittingEmail(false);
                }
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-16 w-16 border-b-4 border-slate-blue mx-auto mb-4"></div>
                            <p className="text-gray-600 font-manrope">Loading your report...</p>
                        </div>
                    </div>
                );
            }

            if (error) {
                return (
                    <div className="min-h-screen flex items-center justify-center px-4">
                        <div className="max-w-md text-center">
                            <div className="text-6xl mb-4">‚ö†Ô∏è</div>
                            <h1 className="text-2xl font-bebas text-gray-800 mb-2">Report Not Found</h1>
                            <p className="text-gray-600 font-manrope mb-4">{error}</p>
                            <a href="/" className="inline-block bg-slate-blue text-white px-6 py-3 rounded-md font-manrope font-semibold hover:bg-slate-blue/90">
                                Take Assessment
                            </a>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <header className="bg-white shadow-sm no-print sticky top-0 z-50">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
                            <div className="flex items-center">
                                <img src="/contre-logo.png" alt="ContRE" className="h-10" />
                            </div>
                            <div className="flex gap-3">
                                <button
                                    onClick={handleShare}
                                    className="flex items-center gap-2 px-4 py-2 border border-gray-300 rounded-md font-manrope text-sm hover:bg-gray-50"
                                >
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                                    </svg>
                                    {copied ? 'Copied!' : 'Share'}
                                </button>
                                <button
                                    onClick={handlePrint}
                                    className="flex items-center gap-2 px-4 py-2 bg-slate-blue text-white rounded-md font-manrope text-sm hover:bg-slate-blue/90"
                                >
                                    <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                                    </svg>
                                    Print / PDF
                                </button>
                            </div>
                        </div>
                    </header>

                    {/* Pre-Email Section (Upper Portion from design) */}
                    <PreEmailSection report={report} gaugeRef={gaugeRef} />

                    {/* Email Gate */}
                    {!emailSubmitted ? (
                        <EmailGateSection
                            email={email}
                            setEmail={setEmail}
                            emailError={emailError}
                            submittingEmail={submittingEmail}
                            handleEmailSubmit={handleEmailSubmit}
                        />
                    ) : (
                        <div id="full-report">
                            {/* Full Report (6 Sections) */}
                            <FullReportSections report={report} />
                        </div>
                    )}

                    {/* Footer */}
                    <footer className="bg-white border-t border-gray-200 mt-16 no-print">
                        <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
                            <div className="text-center text-gray-600 font-manrope text-sm">
                                <p className="mb-2">Report generated by ContRE AI-Powered Brokerage Intelligence</p>
                                <p className="text-xs text-gray-500">
                                    This report expires on {new Date(report.expiresAt).toLocaleDateString()}
                                </p>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        };

        const PreEmailSection = ({ report, gaugeRef }) => {
            const chartInstanceRef = useRef(null);

            useEffect(() => {
                if (gaugeRef.current && report) {
                    // Destroy existing chart if it exists
                    if (chartInstanceRef.current) {
                        chartInstanceRef.current.destroy();
                    }

                    const ctx = gaugeRef.current.getContext('2d');
                    chartInstanceRef.current = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            datasets: [{
                                data: [report.overallScore, 100 - report.overallScore],
                                backgroundColor: [
                                    getScoreColor(report.overallScore),
                                    '#E5E7EB'
                                ],
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            circumference: 180,
                            rotation: 270,
                            cutout: '75%',
                            plugins: {
                                legend: { display: false },
                                tooltip: { enabled: false }
                            }
                        }
                    });
                }

                // Cleanup function
                return () => {
                    if (chartInstanceRef.current) {
                        chartInstanceRef.current.destroy();
                        chartInstanceRef.current = null;
                    }
                };
            }, [report]);

            const getScoreColor = (score) => {
                if (score >= 85) return '#84cc16'; // lime-green
                if (score >= 70) return '#F59E0B'; // amber
                if (score >= 50) return '#F59E0B'; // amber
                return '#CC0000'; // signal-red
            };

            return (
                <div className="bg-white py-12">
                    <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                        {/* Logo */}
                        <div className="text-center mb-8">
                            <img src="/contre-logo.png" alt="ContRE" className="h-16 mx-auto" />
                        </div>

                        {/* Congratulations Header */}
                        <div className="text-center mb-8">
                            <p className="text-gray-600 font-manrope mb-2">Congrats on Finishing Your Risk Questionnaire</p>
                            <h1 className="text-4xl md:text-5xl font-bebas text-gray-800 tracking-wide">
                                HERE'S YOUR<br />TRANSACTIONAL RISK<br />PROFILE
                            </h1>
                        </div>

                        {/* Score Gauge and Summary Grid */}
                        <div className="grid md:grid-cols-2 gap-8 mb-8">
                            {/* Gauge */}
                            <div className="flex justify-center items-center">
                                <div className="relative w-full max-w-sm">
                                    <canvas ref={gaugeRef} width="300" height="180" style={{maxWidth: '100%', height: 'auto'}}></canvas>
                                    <div className="absolute inset-0 flex items-center justify-center" style={{marginTop: '48px'}}>
                                        <div className="text-5xl font-jetbrains font-bold text-gray-800">
                                            {report.overallScore}<span className="text-2xl text-gray-500">/100</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Executive Summary */}
                            <div className="flex flex-col justify-center">
                                <h2 className="text-2xl font-bebas text-gray-800 mb-4">
                                    Your Brokerage is Doing Well But We Have Identified Some Significant Changes You Can Make to Match the Top Brokerages In The Country.
                                </h2>
                                <div className="text-base text-gray-700 font-manrope leading-relaxed space-y-3">
                                    {report.executiveSummary ? (
                                        report.executiveSummary.split('\n\n').map((p, i) => (
                                            <p key={i}>{p}</p>
                                        ))
                                    ) : (
                                        <div className="flex items-center space-x-3 text-amber p-4 bg-amber-50 rounded-lg">
                                            <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-amber"></div>
                                            <p>Our AI is generating your personalized analysis... This takes about 30 seconds.</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>

                        {/* Tagline */}
                        <div className="text-center mt-12 pt-8 border-t border-gray-200">
                            <p className="text-xl font-manrope font-semibold text-gray-800">
                                Our Proprietary AI System Has Created Your Full Report, Along With a 60<br />
                                Day Roadmap to get you into the top 10% of US Brokerages.
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        const EmailGateSection = ({ email, setEmail, emailError, submittingEmail, handleEmailSubmit }) => {
            return (
                <div className="bg-gradient-to-br from-slate-blue to-gray-800 py-16">
                    <div className="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
                        <div className="text-center text-white mb-8">
                            <h2 className="text-4xl md:text-5xl font-bebas mb-4 tracking-wide">
                                Want to See Your Full Report?
                            </h2>
                            <p className="text-xl font-manrope mb-8 text-white/90">
                                Discover the exact systems and capabilities your brokerage can integrate within the next 30-90 days to eliminate inefficiencies and scale profitably.
                            </p>

                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8 text-left">
                                <div className="bg-white/10 backdrop-blur rounded-lg p-5 border border-white/20">
                                    <div className="text-3xl mb-3">üéØ</div>
                                    <h3 className="font-bold text-lg mb-2">Detailed Gap Analysis</h3>
                                    <p className="text-sm text-white/80">See exactly what's broken, why it matters, and the hidden costs</p>
                                </div>
                                <div className="bg-white/10 backdrop-blur rounded-lg p-5 border border-white/20">
                                    <div className="text-3xl mb-3">üó∫Ô∏è</div>
                                    <h3 className="font-bold text-lg mb-2">60-Day Roadmap</h3>
                                    <p className="text-sm text-white/80">Prioritized action plan with quick wins and transformational changes</p>
                                </div>
                                <div className="bg-white/10 backdrop-blur rounded-lg p-5 border border-white/20">
                                    <div className="text-3xl mb-3">üí∞</div>
                                    <h3 className="font-bold text-lg mb-2">ROI Projections</h3>
                                    <p className="text-sm text-white/80">Quantified savings based on your brokerage's actual operations</p>
                                </div>
                            </div>

                            <form onSubmit={handleEmailSubmit} className="max-w-2xl mx-auto">
                                <div className="bg-white rounded-lg p-2 shadow-xl flex flex-col sm:flex-row gap-2">
                                    <input
                                        type="email"
                                        value={email}
                                        onChange={(e) => setEmail(e.target.value)}
                                        placeholder="Enter your work email to unlock your full report"
                                        required
                                        disabled={submittingEmail}
                                        className="flex-1 px-6 py-4 border-0 rounded-md focus:outline-none focus:ring-2 focus:ring-lime-green font-manrope text-lg text-gray-800"
                                    />
                                    <button
                                        type="submit"
                                        disabled={submittingEmail}
                                        className="px-8 py-4 bg-red-600 text-white font-manrope font-bold rounded-md hover:bg-red-700 transition-colors text-lg whitespace-nowrap shadow-lg disabled:opacity-50"
                                    >
                                        {submittingEmail ? 'Submitting...' : 'Get My Full Report ‚Üí'}
                                    </button>
                                </div>
                                {emailError && (
                                    <p className="text-red-300 font-manrope mt-2">{emailError}</p>
                                )}
                            </form>

                            <div className="mt-6 flex flex-wrap items-center justify-center gap-6 text-sm text-white/80">
                                <div className="flex items-center gap-2">
                                    <span>‚úì</span>
                                    <span>Instant access (no wait)</span>
                                </div>
                                <div className="flex items-center gap-2">
                                    <span>‚úì</span>
                                    <span>No credit card required</span>
                                </div>
                                <div className="flex items-center gap-2">
                                    <span>‚úì</span>
                                    <span>Based on 1,000+ assessments</span>
                                </div>
                                <div className="flex items-center gap-2">
                                    <span>üîí</span>
                                    <span>Your data is 100% secure</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const FullReportSections = ({ report }) => {
            if (!report.fullAnalysis) {
                return (
                    <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
                        <div className="bg-white rounded-lg shadow-lg p-8">
                            <div className="flex items-center justify-center space-x-3 text-amber">
                                <div className="animate-spin rounded-full h-6 w-6 border-b-2 border-amber"></div>
                                <p className="text-lg font-manrope">Our AI is analyzing your responses and generating your comprehensive report... This takes about 30 seconds.</p>
                            </div>
                        </div>
                    </div>
                );
            }

            const analysis = report.fullAnalysis;

            return (
                <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 space-y-12">
                    {/* Section 1: Your Operational Snapshot */}
                    <Section1Snapshot report={report} analysis={analysis} />

                    {/* Section 2: Gap Analysis */}
                    <Section2GapAnalysis analysis={analysis} />

                    {/* Section 3: Financial Impact Model */}
                    <Section3FinancialImpact analysis={analysis} />

                    {/* Section 4: 60-Day Transformation Roadmap */}
                    <Section4Roadmap analysis={analysis} />

                    {/* Section 5: Competitive Positioning */}
                    <Section5Positioning report={report} analysis={analysis} />

                    {/* Section 6: Key Insight & Next Steps */}
                    <Section6NextSteps analysis={analysis} />
                </div>
            );
        };

        // SECTION 1: Operational Snapshot
        const Section1Snapshot = ({ report, analysis }) => {
            return (
                <section className="bg-white rounded-lg shadow-lg p-8 page-break">
                    <h2 className="text-3xl font-bebas text-gray-800 mb-6 border-b-2 border-lime-green pb-2">
                        1. YOUR OPERATIONAL SNAPSHOT
                    </h2>

                    {/* Archetype */}
                    {analysis.archetype && (
                        <div className="mb-8 bg-slate-blue/5 border-l-4 border-slate-blue p-6 rounded-r-lg">
                            <h3 className="text-xl font-manrope font-bold text-slate-blue mb-2">
                                Your Operational Archetype: {analysis.archetype.type}
                            </h3>
                            <p className="text-gray-700 font-manrope mb-3">{analysis.archetype.description}</p>
                            {analysis.archetype.typicalChallenges && (
                                <div className="mt-4">
                                    <p className="font-manrope font-semibold text-gray-800 mb-2">Typical Challenges:</p>
                                    <ul className="list-disc list-inside space-y-1 text-gray-700 font-manrope">
                                        {analysis.archetype.typicalChallenges.map((challenge, idx) => (
                                            <li key={idx}>{challenge}</li>
                                        ))}
                                    </ul>
                                </div>
                            )}
                        </div>
                    )}

                    {/* Category Scores */}
                    <div className="mb-8">
                        <h3 className="text-xl font-manrope font-bold text-gray-800 mb-4">Score Breakdown by Category</h3>
                        <div className="space-y-4">
                            {report.categoryScores.map((cat, idx) => (
                                <div key={idx}>
                                    <div className="flex justify-between mb-1">
                                        <span className="font-manrope font-semibold text-gray-700">{cat.category}</span>
                                        <span className="font-jetbrains text-gray-600">{cat.score}/{cat.maxScore} ({cat.percentage}%)</span>
                                    </div>
                                    <div className="w-full bg-gray-200 rounded-full h-3">
                                        <div
                                            className="bg-lime-green h-3 rounded-full transition-all"
                                            style={{ width: `${cat.percentage}%` }}
                                        ></div>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* AI Optimization Gap */}
                    <div className="bg-amber/10 border border-amber/30 rounded-lg p-6">
                        <h3 className="text-xl font-manrope font-bold text-gray-800 mb-3">AI Optimization Gap</h3>
                        <div className="grid md:grid-cols-2 gap-6">
                            <div>
                                <p className="text-sm text-gray-600 font-manrope mb-1">Your Score</p>
                                <p className="text-4xl font-jetbrains font-bold text-gray-800">{report.overallScore}</p>
                            </div>
                            <div>
                                <p className="text-sm text-gray-600 font-manrope mb-1">AI-Optimized Benchmark</p>
                                <p className="text-4xl font-jetbrains font-bold text-lime-green">95-100</p>
                            </div>
                        </div>
                        <p className="mt-4 text-gray-700 font-manrope">
                            Gap to AI-optimized: <span className="font-bold">{100 - report.overallScore} points</span>
                        </p>
                    </div>
                </section>
            );
        };

        // SECTION 2: Gap Analysis
        const Section2GapAnalysis = ({ analysis }) => {
            if (!analysis.gapAnalysis || analysis.gapAnalysis.length === 0) return null;

            return (
                <section className="bg-white rounded-lg shadow-lg p-8 page-break">
                    <h2 className="text-3xl font-bebas text-gray-800 mb-6 border-b-2 border-lime-green pb-2">
                        2. GAP ANALYSIS - CRITICAL OPERATIONAL GAPS
                    </h2>

                    <div className="space-y-8">
                        {analysis.gapAnalysis.map((gap, idx) => (
                            <div key={idx} className="border-l-4 border-signal-red pl-6 pb-6 border-b border-gray-200 last:border-b-0">
                                <div className="flex items-start justify-between mb-3">
                                    <h3 className="text-xl font-manrope font-bold text-gray-800">{gap.category}</h3>
                                    <span className={`px-3 py-1 rounded-full text-xs font-manrope font-semibold ${
                                        gap.severity === 'CRITICAL' ? 'bg-signal-red text-white' :
                                        gap.severity === 'HIGH' ? 'bg-amber text-white' :
                                        'bg-yellow-400 text-gray-800'
                                    }`}>
                                        {gap.severity}
                                    </span>
                                </div>

                                <div className="space-y-4 text-gray-700 font-manrope">
                                    <div>
                                        <p className="font-semibold text-gray-800 mb-1">The Issue:</p>
                                        <p>{gap.issue}</p>
                                    </div>

                                    <div className="bg-gray-50 p-4 rounded-lg">
                                        <p className="font-semibold text-gray-800 mb-1">Evidence from Your Assessment:</p>
                                        <p className="italic">"{gap.evidence}"</p>
                                    </div>

                                    <div>
                                        <p className="font-semibold text-gray-800 mb-2">Business Impact:</p>
                                        <div className="grid md:grid-cols-3 gap-4 text-sm">
                                            <div className="bg-red-50 p-3 rounded">
                                                <p className="font-semibold text-gray-700 mb-1">Time Wasted:</p>
                                                <p>{gap.businessImpact.timeWasted}</p>
                                            </div>
                                            <div className="bg-red-50 p-3 rounded">
                                                <p className="font-semibold text-gray-700 mb-1">Financial Cost:</p>
                                                <p>{gap.businessImpact.financialCost}</p>
                                            </div>
                                            <div className="bg-red-50 p-3 rounded">
                                                <p className="font-semibold text-gray-700 mb-1">Risk Created:</p>
                                                <p>{gap.businessImpact.riskCreated}</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-lime-green/10 border-l-4 border-lime-green p-4">
                                        <p className="font-semibold text-gray-800 mb-1">What Top 5% Do Differently:</p>
                                        <p>{gap.industryBestPractice}</p>
                                    </div>
                                </div>
                            </div>
                        ))}
                    </div>
                </section>
            );
        };

        // SECTION 3: Financial Impact Model
        const Section3FinancialImpact = ({ analysis }) => {
            if (!analysis.financialImpact) return null;

            const impact = analysis.financialImpact;

            return (
                <section className="bg-white rounded-lg shadow-lg p-8 page-break">
                    <h2 className="text-3xl font-bebas text-gray-800 mb-6 border-b-2 border-lime-green pb-2">
                        3. FINANCIAL IMPACT MODEL
                    </h2>

                    <div className="grid md:grid-cols-2 gap-8 mb-8">
                        {/* Current State Costs */}
                        <div className="bg-red-50 border-2 border-signal-red rounded-lg p-6">
                            <h3 className="text-xl font-bebas text-signal-red mb-4">CURRENT STATE ANNUAL COSTS</h3>
                            <div className="space-y-3 font-manrope text-sm">
                                <div className="flex justify-between pb-2 border-b border-red-200">
                                    <span className="text-gray-700">Manual Document Review:</span>
                                    <span className="font-semibold">{impact.currentStateCosts.manualDocumentReview}</span>
                                </div>
                                <div className="flex justify-between pb-2 border-b border-red-200">
                                    <span className="text-gray-700">Missed Deadlines:</span>
                                    <span className="font-semibold">{impact.currentStateCosts.missedDeadlines}</span>
                                </div>
                                <div className="flex justify-between pb-2 border-b border-red-200">
                                    <span className="text-gray-700">E&O Risk:</span>
                                    <span className="font-semibold">{impact.currentStateCosts.eoRisk}</span>
                                </div>
                                <div className="flex justify-between pt-3 text-lg">
                                    <span className="font-bold text-gray-800">Total Annual Leakage:</span>
                                    <span className="font-bold text-signal-red">{impact.currentStateCosts.totalAnnual}</span>
                                </div>
                            </div>
                        </div>

                        {/* Projected Savings */}
                        <div className="bg-green-50 border-2 border-lime-green rounded-lg p-6">
                            <h3 className="text-xl font-bebas text-lime-green mb-4">PROJECTED ANNUAL SAVINGS</h3>
                            <div className="space-y-3 font-manrope text-sm">
                                <div className="flex justify-between pb-2 border-b border-green-200">
                                    <span className="text-gray-700">Time Reclaimed:</span>
                                    <span className="font-semibold">{impact.projectedSavings.timeReclaimed}</span>
                                </div>
                                <div className="flex justify-between pb-2 border-b border-green-200">
                                    <span className="text-gray-700">Deals Protected:</span>
                                    <span className="font-semibold">{impact.projectedSavings.dealsProtected}</span>
                                </div>
                                <div className="flex justify-between pb-2 border-b border-green-200">
                                    <span className="text-gray-700">Risk Reduction:</span>
                                    <span className="font-semibold">{impact.projectedSavings.riskReduction}</span>
                                </div>
                                <div className="flex justify-between pt-3 text-lg">
                                    <span className="font-bold text-gray-800">Total Projected Savings:</span>
                                    <span className="font-bold text-lime-green">{impact.projectedSavings.totalAnnual}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* ROI */}
                    {impact.projectedSavings.roi && (
                        <div className="bg-slate-blue text-white rounded-lg p-6 text-center mb-6">
                            <p className="text-sm font-manrope mb-2">PROJECTED ROI</p>
                            <p className="text-4xl font-bebas">{impact.projectedSavings.roi}</p>
                        </div>
                    )}

                    {/* Implementation Note */}
                    {impact.implementationNote && (
                        <div className="bg-blue-50 border-l-4 border-slate-blue p-4 rounded-r-lg">
                            <p className="text-gray-700 font-manrope text-sm">{impact.implementationNote}</p>
                        </div>
                    )}
                </section>
            );
        };

        // SECTION 4: 60-Day Roadmap
        const Section4Roadmap = ({ analysis }) => {
            if (!analysis.roadmap) return null;

            const roadmap = analysis.roadmap;
            const phases = [
                { name: 'Quick Wins', days: '0-20 Days', items: roadmap.quickWins || [], color: 'bg-green-100 border-green-400' },
                { name: 'Foundation Building', days: '20-40 Days', items: roadmap.foundationBuilding || [], color: 'bg-blue-100 border-blue-400' },
                { name: 'Transformation', days: '40-60 Days', items: roadmap.transformation || [], color: 'bg-purple-100 border-purple-400' }
            ];

            return (
                <section className="bg-white rounded-lg shadow-lg p-8 page-break">
                    <h2 className="text-3xl font-bebas text-gray-800 mb-6 border-b-2 border-lime-green pb-2">
                        4. YOUR 60-DAY TRANSFORMATION ROADMAP
                    </h2>

                    <div className="space-y-8">
                        {phases.map((phase, phaseIdx) => (
                            phase.items.length > 0 && (
                                <div key={phaseIdx}>
                                    <div className="mb-4">
                                        <h3 className="text-2xl font-bebas text-gray-800">{phase.name}</h3>
                                        <p className="text-sm text-gray-600 font-manrope">{phase.days}</p>
                                    </div>

                                    <div className="space-y-4">
                                        {phase.items.map((item, idx) => (
                                            <div key={idx} className={`border-l-4 ${phase.color} p-4 rounded-r-lg`}>
                                                <h4 className="font-manrope font-bold text-gray-800 mb-2">{item.action}</h4>
                                                <div className="space-y-2 text-sm text-gray-700 font-manrope">
                                                    <p><span className="font-semibold">Addresses:</span> {item.addresses}</p>
                                                    <p><span className="font-semibold">Implementation:</span> {item.implementation}</p>
                                                    <p><span className="font-semibold">Expected Outcome:</span> {item.expectedOutcome}</p>
                                                    {item.modernApproach && (
                                                        <div className="mt-3 bg-white/50 p-3 rounded border border-gray-200">
                                                            <p className="text-xs font-semibold text-gray-600 mb-1">How Top Performers Do This:</p>
                                                            <p className="text-xs">{item.modernApproach}</p>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )
                        ))}
                    </div>
                </section>
            );
        };

        // SECTION 5: Competitive Positioning
        const Section5Positioning = ({ report, analysis }) => {
            if (!analysis.competitivePositioning) return null;

            const positioning = analysis.competitivePositioning;

            return (
                <section className="bg-white rounded-lg shadow-lg p-8 page-break">
                    <h2 className="text-3xl font-bebas text-gray-800 mb-6 border-b-2 border-lime-green pb-2">
                        5. COMPETITIVE POSITIONING
                    </h2>

                    {/* Strengths & Weaknesses */}
                    <div className="grid md:grid-cols-2 gap-6 mb-8">
                        {/* Strengths */}
                        {positioning.strengths && positioning.strengths.length > 0 && (
                            <div className="bg-green-50 border border-green-200 rounded-lg p-6">
                                <h3 className="text-xl font-bebas text-lime-green mb-4">YOUR STRENGTHS</h3>
                                <ul className="space-y-2 font-manrope text-sm">
                                    {positioning.strengths.map((strength, idx) => (
                                        <li key={idx} className="flex items-start">
                                            <span className="text-lime-green mr-2">‚úì</span>
                                            <span>{strength}</span>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        )}

                        {/* Weaknesses */}
                        {positioning.weaknesses && positioning.weaknesses.length > 0 && (
                            <div className="bg-red-50 border border-red-200 rounded-lg p-6">
                                <h3 className="text-xl font-bebas text-signal-red mb-4">GAPS TO ADDRESS</h3>
                                <ul className="space-y-2 font-manrope text-sm">
                                    {positioning.weaknesses.map((weakness, idx) => (
                                        <li key={idx} className="flex items-start">
                                            <span className="text-signal-red mr-2">‚ö†</span>
                                            <span>{weakness}</span>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        )}
                    </div>

                    {/* Percentile Analysis */}
                    {positioning.percentileAnalysis && (
                        <div className="bg-slate-blue/5 border-l-4 border-slate-blue p-6 rounded-r-lg mb-6">
                            <h3 className="text-lg font-manrope font-bold text-gray-800 mb-2">Where You Stand</h3>
                            <p className="text-gray-700 font-manrope">{positioning.percentileAnalysis}</p>
                        </div>
                    )}

                    {/* Gap to Leaders */}
                    {positioning.gapToLeaders && (
                        <div className="bg-amber/10 border border-amber/30 rounded-lg p-6">
                            <h3 className="text-lg font-manrope font-bold text-gray-800 mb-2">What Sets Top 10% Apart</h3>
                            <p className="text-gray-700 font-manrope">{positioning.gapToLeaders}</p>
                        </div>
                    )}
                </section>
            );
        };

        // SECTION 6: Key Insight & Next Steps
        const Section6NextSteps = ({ analysis }) => {
            return (
                <section className="bg-white rounded-lg shadow-lg p-8">
                    <h2 className="text-3xl font-bebas text-gray-800 mb-6 border-b-2 border-lime-green pb-2">
                        6. KEY INSIGHT & NEXT STEPS
                    </h2>

                    {/* Key Insight */}
                    {analysis.keyInsight && (
                        <div className="bg-gradient-to-r from-slate-blue to-slate-blue/80 text-white rounded-lg p-8 mb-8">
                            <h3 className="text-2xl font-bebas mb-4">YOUR "AHA MOMENT"</h3>
                            <p className="text-lg font-manrope leading-relaxed">{analysis.keyInsight}</p>
                        </div>
                    )}

                    {/* Specific Recommendations */}
                    {analysis.specificRecommendations && analysis.specificRecommendations.length > 0 && (
                        <div className="mb-8">
                            <h3 className="text-2xl font-bebas text-gray-800 mb-4">SPECIFIC RECOMMENDATIONS FOR YOU</h3>
                            <div className="space-y-6">
                                {analysis.specificRecommendations.map((rec, idx) => (
                                    <div key={idx} className="border-l-4 border-lime-green pl-6 pb-6 border-b border-gray-200 last:border-b-0">
                                        <h4 className="text-lg font-manrope font-bold text-gray-800 mb-2">{rec.recommendation}</h4>
                                        <div className="space-y-2 text-sm text-gray-700 font-manrope">
                                            <p><span className="font-semibold">Why:</span> {rec.rationale}</p>
                                            <p><span className="font-semibold">Expected Outcome:</span> {rec.expectedOutcome}</p>
                                            {rec.howTopBrokeragesDoThis && (
                                                <div className="mt-3 bg-blue-50 p-3 rounded">
                                                    <p className="text-xs font-semibold text-gray-600 mb-1">How Top Brokerages Do This:</p>
                                                    <p className="text-xs">{rec.howTopBrokeragesDoThis}</p>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* CTA Section */}
                    <div className="bg-gray-50 rounded-lg p-8 text-center">
                        <h3 className="text-2xl font-bebas text-gray-800 mb-4">READY TO TRANSFORM YOUR BROKERAGE?</h3>
                        <p className="text-gray-700 font-manrope mb-6 max-w-2xl mx-auto">
                            See how ContRE's AI-powered platform helps top brokerages eliminate the gaps identified in your assessment.
                            Schedule a complimentary 30-minute strategy session to discuss your specific situation.
                        </p>
                        <a
                            href="https://calendly.com/contre"
                            target="_blank"
                            rel="noopener noreferrer"
                            className="inline-block bg-slate-blue text-white px-8 py-4 rounded-md font-manrope font-semibold text-lg hover:bg-slate-blue/90 transition-all shadow-lg hover:shadow-xl no-print"
                        >
                            Schedule Your Strategy Session
                        </a>
                    </div>
                </section>
            );
        };

        // Render the app
        ReactDOM.render(<ReportPage />, document.getElementById('root'));
    </script>
</body>
</html>
